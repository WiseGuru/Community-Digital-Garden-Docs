<button id="theme-toggle" class="btn" type="button" aria-label="Toggle color theme">🌙</button>

<script>
(function () {
  // use Just the Docs' helper
  function apply(theme) {
    jtd.setTheme(theme);                    // 'light' or 'dark'
    localStorage.setItem('jtd-theme', theme);
    updateIcon(theme);
  }
  function updateIcon(theme) {
    const btn = document.getElementById('theme-toggle');
    if (!btn) return;
    btn.textContent = theme === 'dark' ? '☀️' : '🌙';
    btn.setAttribute('aria-pressed', theme === 'dark');
  }

  // 1) load saved, else match system
  let theme = localStorage.getItem('jtd-theme');
  if (!theme) {
    const prefersDark = window.matchMedia &&
      window.matchMedia('(prefers-color-scheme: dark)').matches;
    theme = prefersDark ? 'dark' : 'light';
  }
  apply(theme);

  // 2) listen for manual toggle
  document.getElementById('theme-toggle')?.addEventListener('click', () => {
    const next = (localStorage.getItem('jtd-theme') === 'dark') ? 'light' : 'dark';
    sessionStorage.setItem('jtd-theme-manual', '1');
    apply(next);
  });

  // 3) follow system changes unless user toggled this session
  const mq = window.matchMedia('(prefers-color-scheme: dark)');
  mq.addEventListener?.('change', (e) => {
    const manual = sessionStorage.getItem('jtd-theme-manual') === '1';
    if (!manual) apply(e.matches ? 'dark' : 'light');
  });

  // 4) hint to UA for form controls/scrollbars
  const meta = document.createElement('meta');
  meta.name = 'color-scheme';
  meta.content = 'light dark';
  document.head.appendChild(meta);
})();
</script>
